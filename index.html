<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>문제 풀이 웹</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap');

        body {
            display: flex;
            height: 100vh;
            margin: 0;
            font-family: 'Gowun Batang', sans-serif;
            transition: all 0.3s ease;
        }
        #left {
            width: 20%; 
            padding: 20px;
            box-sizing: border-box;
            background-color: #ffb8b8;
            overflow-y: auto;
        }
        #center {
            width: 65%; 
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: flex-start;
            transition: width 0.3s ease;
        }
        #right {
            width: 15%; 
            padding: 20px;
            box-sizing: border-box;
            background-color: #ffdfdf;
        }
        #result {
            margin-top: 20px;
            font-weight: bold;
        }
        img {
            max-width: 100%; 
            height: auto; 
            margin-top: 20px; 
        }
        .collapsible {
            cursor: pointer; 
            user-select: none; 
            margin: 5px 0;
        }
        .highlight {
            color: rgb(0, 0, 0); 
            text-align: center; 
        }
        .floating-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: #ff6f61;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
        }
        .question-title {
            font-size: 20px; 
            font-weight: bold; 
            margin-top: 10px; 
        }
    </style>
</head>
<body>
    <div id="left">
        <span class="highlight"><h2>문항 선택</h2></span>
        <ul id="questionList"></ul>
    </div>
    
    <div id="center">
        <div id="questionTitle" class="question-title" style="display:none;"></div>
        <img id="selectedImage" src="" alt="선택한 문제 이미지" style="display:none;">
    </div>
    
    <div id="right">
        <span class="highlight"><h2>답 입력</h2></span>
        <input type="text" id="answer" placeholder="답을 입력하세요">
        <button onclick="checkAnswer()">제출</button>
        
        <div id="result"></div>
        <div id="solutionLink" style="margin-top: 10px;"></div>
    </div>
    
    <button class="floating-button" onclick="toggleMenu()">☰</button>
    
    <script>
        let correctAnswer = "";
        let solutionLink = "";
        let menuVisible = true;

        // JSON 데이터 불러오기
        fetch('questions.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                generateMenu(data);
            })
            .catch(error => console.error('Error loading JSON:', error));

        // collapsible 아이템 생성 함수 (직계 자식 ul 토글)
        function createCollapsibleItem(text) {
            const li = document.createElement("li");
            li.textContent = text;
            li.classList.add("collapsible");
            li.addEventListener("click", function(e) {
                // :scope > ul 을 사용하여 직계 자식 ul만 선택
                const childUl = this.querySelector(":scope > ul");
                if(childUl) {
                    childUl.style.display = childUl.style.display === "block" ? "none" : "block";
                }
                e.stopPropagation(); // 상위 요소로의 이벤트 전파 방지
            });
            return li;
        }

        // 메뉴 자동 생성 함수 (모든 하위 메뉴 초기 상태는 닫힘)
        function generateMenu(questions) {
            const questionList = document.getElementById("questionList");
            questions.forEach(question => {
                // 1단계: 대분류
                const categoryLi = createCollapsibleItem(question.대분류);
                const subList = document.createElement("ul");
                subList.style.display = "none"; // 초기 닫힘
                categoryLi.appendChild(subList);
                questionList.appendChild(categoryLi);

                // 2단계: 중분류
                const subCategoryLi = createCollapsibleItem(question.중분류);
                const subCategoryList = document.createElement("ul");
                subCategoryList.style.display = "none";
                subCategoryLi.appendChild(subCategoryList);
                subList.appendChild(subCategoryLi);

                // 3단계: 소분류
                const smallCategoryLi = createCollapsibleItem(question.소분류);
                const smallCategoryList = document.createElement("ul");
                smallCategoryList.style.display = "none";
                smallCategoryLi.appendChild(smallCategoryList);
                subCategoryList.appendChild(smallCategoryLi);

                // 4단계: 문항들 (leaf 노드: 별도 토글 기능 없음, 클릭 시 문제 선택)
                question.문항들.forEach(item => {
                    const questionLi = document.createElement("li");
                    questionLi.textContent = item.문항번호;
                    // 문항 선택 시 이벤트 처리 (상위 메뉴 토글 이벤트와 분리)
                    questionLi.addEventListener("click", function(e) {
                        selectQuestion(item);
                        e.stopPropagation();
                    });
                    smallCategoryList.appendChild(questionLi);
                });
            });
        }

        function toggleMenu() {
            menuVisible = !menuVisible;
            document.getElementById("left").style.display = menuVisible ? "block" : "none";
            document.getElementById("center").style.width = menuVisible ? "65%" : "85%";
            document.getElementById("right").style.width = "15%";
        }

        function selectQuestion(question) {
            document.getElementById("selectedImage").src = question.문항주소;
            document.getElementById("selectedImage").style.display = "block";
            document.getElementById("questionTitle").innerText = question.문항제목;
            document.getElementById("questionTitle").style.display = "block";
            correctAnswer = question.정답;
            solutionLink = question.해설주소;
            document.getElementById("result").innerHTML = "";
            document.getElementById("solutionLink").innerHTML = "";
        }

        function checkAnswer() {
            const userAnswer = document.getElementById("answer").value;
            const resultDiv = document.getElementById("result");
            const solutionDiv = document.getElementById("solutionLink");

            if (userAnswer === correctAnswer) {
                resultDiv.innerHTML = "정답입니다!";
                solutionDiv.innerHTML = "";
            } else {
                resultDiv.innerHTML = "오답입니다!";
                solutionDiv.innerHTML = `해설 영상을 보세요: <a href='${solutionLink}' target='_blank'>해설 영상</a>`;
            }
        }
    </script>
</body>
</html>
